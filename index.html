<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo App</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4 max-w-2xl">
        <h1 class="text-3xl font-bold mb-6">Todo App</h1>
        
        <!-- API Testing Section -->
        <div class="mb-8 bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-bold mb-4">API Testing</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">API Endpoint:</label>
                    <select id="apiEndpoint" class="w-full p-2 border rounded">
                        <option value="GET">GET /todos</option>
                        <option value="POST">POST /todos</option>
                        <option value="PUT">PUT /todos/:id</option>
                        <option value="DELETE">DELETE /todos/:id</option>
                    </select>
                </div>
                <div id="requestBody" class="hidden">
                    <label class="block text-sm font-medium mb-1">Request Body (JSON):</label>
                    <textarea id="requestJson" class="w-full p-2 border rounded h-32 font-mono text-sm"></textarea>
                </div>
                <div id="todoIdInput" class="hidden">
                    <label class="block text-sm font-medium mb-1">Todo ID:</label>
                    <input type="number" id="todoId" class="w-full p-2 border rounded">
                </div>
                <button onclick="testEndpoint()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Test Endpoint
                </button>
                <div>
                    <label class="block text-sm font-medium mb-1">Response:</label>
                    <pre id="apiResponse" class="bg-gray-100 p-4 rounded overflow-auto max-h-48 font-mono text-sm"></pre>
                </div>
            </div>
        </div>

        <!-- Todo Form -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <form id="todoForm" class="space-y-4">
                <input type="hidden" id="editId">
                <div>
                    <label class="block text-sm font-medium mb-1">Title:</label>
                    <input type="text" id="title" required class="w-full p-2 border rounded">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Description:</label>
                    <input type="text" id="description" class="w-full p-2 border rounded">
                </div>
                <button type="submit" class="w-full bg-green-500 text-white p-2 rounded hover:bg-green-600">
                    Add Todo
                </button>
            </form>
        </div>

        <!-- Todo List -->
        <div id="todoList" class="space-y-4"></div>
    </div>

    <script>
        // Initialize todos from localStorage or empty array
        let todos = JSON.parse(localStorage.getItem('todos') || '[]');
        if (todos.length === 0) {
            todos.push({
                id: 1,
                title: "Sample Todo",
                description: "This is a test todo",
                completed: false,
                createdAt: new Date()
            });
            saveTodos();
        }

        // Save todos to localStorage
        function saveTodos() {
            localStorage.setItem('todos', JSON.stringify(todos));
        }

        // API Endpoints
        const api = {
            // GET /todos
            getTodos: () => {
                return new Promise(resolve => {
                    resolve(todos);
                });
            },

            // GET /todos/:id
            getTodo: (id) => {
                return new Promise((resolve, reject) => {
                    const todo = todos.find(t => t.id === parseInt(id));
                    if (todo) {
                        resolve(todo);
                    } else {
                        reject(new Error('Todo not found'));
                    }
                });
            },

            // POST /todos
            createTodo: (data) => {
                return new Promise(resolve => {
                    const newTodo = {
                        id: Math.max(0, ...todos.map(t => t.id)) + 1,
                        title: data.title,
                        description: data.description,
                        completed: false,
                        createdAt: new Date()
                    };
                    todos.push(newTodo);
                    saveTodos();
                    resolve(newTodo);
                });
            },

            // PUT /todos/:id
            updateTodo: (id, data) => {
                return new Promise((resolve, reject) => {
                    const index = todos.findIndex(t => t.id === parseInt(id));
                    if (index !== -1) {
                        todos[index] = { ...todos[index], ...data };
                        saveTodos();
                        resolve(todos[index]);
                    } else {
                        reject(new Error('Todo not found'));
                    }
                });
            },

            // DELETE /todos/:id
            deleteTodo: (id) => {
                return new Promise((resolve, reject) => {
                    const index = todos.findIndex(t => t.id === parseInt(id));
                    if (index !== -1) {
                        todos = todos.filter(t => t.id !== parseInt(id));
                        saveTodos();
                        resolve({ message: 'Todo deleted successfully' });
                    } else {
                        reject(new Error('Todo not found'));
                    }
                });
            }
        };

        // UI Functions
        function renderTodos() {
            const todoList = document.getElementById('todoList');
            todoList.innerHTML = todos.map(todo => `
                <div class="bg-white rounded-lg shadow-md p-4 ${todo.completed ? 'bg-gray-50' : ''}">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <h3 class="text-lg font-medium ${todo.completed ? 'line-through' : ''}">${todo.title}</h3>
                            <p class="text-gray-600">${todo.description || ''}</p>
                            <p class="text-sm text-gray-500">ID: ${todo.id}</p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="toggleComplete(${todo.id})"
                                class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">
                                ${todo.completed ? 'Undo' : 'Complete'}
                            </button>
                            <button onclick="editTodo(${todo.id})"
                                class="px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600">
                                Edit
                            </button>
                            <button onclick="deleteTodo(${todo.id})"
                                class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600">
                                Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Form handling
        document.getElementById('todoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const title = document.getElementById('title').value;
            const description = document.getElementById('description').value;
            const editId = document.getElementById('editId').value;

            try {
                if (editId) {
                    await api.updateTodo(editId, { title, description });
                    document.getElementById('editId').value = '';
                } else {
                    await api.createTodo({ title, description });
                }
                document.getElementById('title').value = '';
                document.getElementById('description').value = '';
                renderTodos();
            } catch (error) {
                console.error('Error:', error);
                alert(error.message);
            }
        });

        // API Testing UI
        document.getElementById('apiEndpoint').addEventListener('change', function() {
            const method = this.value;
            document.getElementById('requestBody').style.display = 
                (method === 'POST' || method === 'PUT') ? 'block' : 'none';
            document.getElementById('todoIdInput').style.display = 
                (method === 'PUT' || method === 'DELETE') ? 'block' : 'none';
            
            // Set example request body
            if (method === 'POST' || method === 'PUT') {
                document.getElementById('requestJson').value = JSON.stringify({
                    title: "Example Todo",
                    description: "This is an example"
                }, null, 2);
            }
        });

        async function testEndpoint() {
            const method = document.getElementById('apiEndpoint').value;
            const responseEl = document.getElementById('apiResponse');
            
            try {
                let response;
                switch (method) {
                    case 'GET':
                        response = await api.getTodos();
                        break;
                    case 'POST':
                        const postData = JSON.parse(document.getElementById('requestJson').value);
                        response = await api.createTodo(postData);
                        break;
                    case 'PUT':
                        const putData = JSON.parse(document.getElementById('requestJson').value);
                        const putId = document.getElementById('todoId').value;
                        response = await api.updateTodo(putId, putData);
                        break;
                    case 'DELETE':
                        const deleteId = document.getElementById('todoId').value;
                        response = await api.deleteTodo(deleteId);
                        break;
                }
                responseEl.textContent = JSON.stringify(response, null, 2);
                renderTodos();
            } catch (error) {
                responseEl.textContent = `Error: ${error.message}`;
            }
        }

        // CRUD Operations
        async function toggleComplete(id) {
            try {
                const todo = todos.find(t => t.id === id);
                await api.updateTodo(id, { completed: !todo.completed });
                renderTodos();
            } catch (error) {
                alert(error.message);
            }
        }

        async function editTodo(id) {
            const todo = todos.find(t => t.id === id);
            document.getElementById('editId').value = todo.id;
            document.getElementById('title').value = todo.title;
            document.getElementById('description').value = todo.description || '';
        }

        async function deleteTodo(id) {
            try {
                await api.deleteTodo(id);
                renderTodos();
            } catch (error) {
                alert(error.message);
            }
        }

        // Initial render
        renderTodos();
    </script>
</body>
</html>
